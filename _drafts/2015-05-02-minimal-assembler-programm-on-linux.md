---
layout:		post
comments:	true
title:		Минимальная ассемблер программа для Linux
date:		2015-05-02
categories:
- asm
---

Программа, которая ничего не делает, и возвращает `0`:

{% highlight asm %}
.section .data
.section .text
.globl _start
_start:
# Linux system call для выхода из программы
movl $1, %eax

# Возвращаемое программой значение
movl $0, %ebx

# Разбудить ядро, для исполнения нашего системного вызова
int $0x80
{% endhighlight %}

О том как это все работает. Все что начинается с `.` является инструкцией ассемблеру, и не транслируется в машинный код. `.section` как можно было догадаться, разбивает нашу программу на секции:

+ `.data` - представляет собой редактируемое хранилище глобальных и локальных статических переменных
+ `.rodata` - представляет собой не редактируемое хранилище константных данных
+ `.text` - секция, где находится наша программа т.е. инструкции.

`.globl _start` - определяет новый симбол `_start`, который фактически определяет начало нашей программы, которому дальше присваивается значение представляющее собой наше программу(`_start:`).

Инструкция `movl`, как опять таки можно было догадаться, перемещает данные из источника в приемник символ `$` говорит о том, что нужно использовать immediate mode т.е. записать в регистр, все что идет после этого символа.

Таким образом, все что делает эта программа - записывает в регистр `eax` значение `1`, которое соответствует системному вызову ядра `exit`, который вернет ОС значение, находящееся в регистре `ebx`, и так как ядро гордое, то пока мы его не попросим, ничего не произойдет, поэтому мы его просим, выполнить наш системный вызов, с помощью прерывания - `int $0x80`. Такой вот `return 0;`

#### Как собрать
Для того чтобы собрать и запустить программу, нужно получить объектный файл, который нужно слинковать, и тем самым получить исполняемый файл:

{% highlight bash %}
# Устанавливаем необходимые утилиты
sudo apt-get install build-essential
# Assemble
as programm.s -o programm.o
# Link
ld programm.o -o programm
# Execute
./programm
# Смотрим, какое значение, вернула наша программа
echo $?
{% endhighlight %}
